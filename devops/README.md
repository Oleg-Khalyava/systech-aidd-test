# DevOps - Docker Setup

ะญัะฐ ะฟะฐะฟะบะฐ ัะพะดะตัะถะธั ะฒัะต ะฝะตะพะฑัะพะดะธะผัะต ัะฐะนะปั ะดะปั ะทะฐะฟััะบะฐ ะฟัะพะตะบัะฐ ัะตัะตะท Docker.

## ๐ ะกัััะบัััะฐ

```
devops/
โโโ bot.Dockerfile          # Dockerfile ะดะปั Telegram Bot
โโโ api.Dockerfile          # Dockerfile ะดะปั Backend API
โโโ frontend.Dockerfile     # Dockerfile ะดะปั Frontend
โโโ bot.dockerignore        # ะะณะฝะพัะธััะตะผัะต ัะฐะนะปั ะดะปั Bot
โโโ api.dockerignore        # ะะณะฝะพัะธััะตะผัะต ัะฐะนะปั ะดะปั API
โโโ frontend.dockerignore   # ะะณะฝะพัะธััะตะผัะต ัะฐะนะปั ะดะปั Frontend
โโโ doc/
โ   โโโ devops-roadmap.md   # Roadmap DevOps ัะฟัะธะฝัะพะฒ
โ   โโโ env-template.md     # ะจะฐะฑะปะพะฝ .env ัะฐะนะปะฐ
โโโ README.md               # ะญัะพั ัะฐะนะป
```

## ๐ ะัััััะน ััะฐัั

### 1. ะะฐัััะพะนะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั

ะกะพะทะดะฐะนัะต ัะฐะนะป `.env` ะฒ ะบะพัะฝะต ะฟัะพะตะบัะฐ:

```bash
# ะกะบะพะฟะธััะนัะต ัะฐะฑะปะพะฝ (ะธะท ะบะพัะฝั ะฟัะพะตะบัะฐ)
cp .env.example .env

# ะะปะธ ัะพะทะดะฐะนัะต ะฒัััะฝัั, ะธัะฟะพะปัะทัั ัะฐะฑะปะพะฝ ะธะท devops/doc/env-template.md
```

ะะธะฝะธะผะฐะปัะฝะพ ะฝะตะพะฑัะพะดะธะผัะต ะฟะตัะตะผะตะฝะฝัะต:
```bash
TELEGRAM_BOT_TOKEN=your_bot_token
OPENROUTER_API_KEY=your_api_key
```

### 2. ะะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ

```bash
# ะะท ะบะพัะฝั ะฟัะพะตะบัะฐ
make docker-up

# ะะปะธ ะฝะฐะฟััะผัั
docker-compose up -d
```

### 3. ะัะพะฒะตัะบะฐ ััะฐัััะฐ

```bash
# ะัะพะฒะตัะธัั ััะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ
make docker-status

# ะะพัะผะพััะตัั ะปะพะณะธ
make docker-logs
```

## ๐ณ Docker ะบะพะผะฐะฝะดั

| ะะพะผะฐะฝะดะฐ | ะะฟะธัะฐะฝะธะต |
|---------|----------|
| `make docker-up` | ะะฐะฟัััะธัั ะฒัะต ัะตัะฒะธัั (detached mode) |
| `make docker-down` | ะััะฐะฝะพะฒะธัั ะฒัะต ัะตัะฒะธัั |
| `make docker-restart` | ะะตัะตะทะฐะฟัััะธัั ัะตัะฒะธัั |
| `make docker-logs` | ะะพะบะฐะทะฐัั ะปะพะณะธ (follow mode) |
| `make docker-status` | ะะพะบะฐะทะฐัั ััะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ |
| `make docker-clean` | ะัะธััะธัั ะบะพะฝัะตะนะฝะตัั ะธ volumes |

## ๐ฆ ะกะตัะฒะธัั

### Bot (Telegram Bot)
- **Dockerfile:** `devops/bot.Dockerfile`
- **ะะพะฝัะตะนะฝะตั:** `telegram-bot`
- **ะะพััั:** ะฝะตั (ัะฐะฑะพัะฐะตั ัะตัะตะท Telegram API)
- **Volumes:** `./data`, `./logs`

### API (Backend API)
- **Dockerfile:** `devops/api.Dockerfile`
- **ะะพะฝัะตะนะฝะตั:** `backend-api`
- **ะะพััั:** `8000:8000`
- **Volumes:** `./data`, `./logs`
- **URL:** http://localhost:8000/docs

### Frontend (Next.js)
- **Dockerfile:** `devops/frontend.Dockerfile`
- **ะะพะฝัะตะนะฝะตั:** `frontend-web`
- **ะะพััั:** `3000:3000`
- **URL:** http://localhost:3000

## ๐ง ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Frontend (Next.js)                โ
โ   http://localhost:3000             โ
โ   Container: frontend-web           โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโ
               โ HTTP API
               โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Backend API (FastAPI)             โ
โ   http://localhost:8000             โ
โ   Container: backend-api            โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโ
               โ SQLite
               โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Telegram Bot (aiogram)            โ
โ   Container: telegram-bot           โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โผ
      SQLite Database (./data/bot.db)
```

## ๐๏ธ Volumes

- `./data:/app/data` - SQLite ะฑะฐะทะฐ ะดะฐะฝะฝัั (ะฟะตััะธััะตะฝัะฝะฐั)
- `./logs:/app/logs` - ะะพะณะธ ะฒัะตั ัะตัะฒะธัะพะฒ

## ๐ ะัะพะฒะตัะบะฐ ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััะธ

### Bot
```bash
# ะัะพะฒะตัะธัั ะปะพะณะธ
docker-compose logs bot

# ะฃะฑะตะดะธัััั, ััะพ ะผะธะณัะฐัะธะธ ะฟัะธะผะตะฝะธะปะธัั
docker-compose exec bot ls -la data/

# ะัะพะฒะตัะธัั, ััะพ ะะ ัะพะทะดะฐะปะฐัั
docker-compose exec bot ls -la data/bot.db
```

### API
```bash
# ะัะบัััั ะดะพะบัะผะตะฝัะฐัะธั API
open http://localhost:8000/docs

# ะัะพะฒะตัะธัั ัะฝะดะฟะพะธะฝั ััะฐัะธััะธะบะธ
curl http://localhost:8000/stats?period=week
```

### Frontend
```bash
# ะัะบัััั ะฒ ะฑัะฐัะทะตัะต
open http://localhost:3000

# ะัะพะฒะตัะธัั ะปะพะณะธ
docker-compose logs frontend
```

## ๐๏ธ ะัะปะฐะดะบะฐ

### ะัะพัะผะพัั ะปะพะณะพะฒ ะบะพะฝะบัะตัะฝะพะณะพ ัะตัะฒะธัะฐ
```bash
docker-compose logs -f bot
docker-compose logs -f api
docker-compose logs -f frontend
```

### ะัะพะด ะฒ ะบะพะฝัะตะนะฝะตั
```bash
docker-compose exec bot /bin/bash
docker-compose exec api /bin/bash
docker-compose exec frontend /bin/sh
```

### ะะตัะตัะฑะพัะบะฐ ะพะฑัะฐะทะพะฒ
```bash
# ะะตัะตัะพะฑัะฐัั ะฒัะต ะพะฑัะฐะทั
docker-compose build

# ะะตัะตัะพะฑัะฐัั ะบะพะฝะบัะตัะฝัะน ัะตัะฒะธั
docker-compose build bot
docker-compose build api
docker-compose build frontend

# ะะตัะตัะพะฑัะฐัั ะฑะตะท ะบะตัะฐ
docker-compose build --no-cache
```

### ะัะธััะบะฐ
```bash
# ะััะฐะฝะพะฒะธัั ะธ ัะดะฐะปะธัั ะบะพะฝัะตะนะฝะตัั
docker-compose down

# ะััะฐะฝะพะฒะธัั ะธ ัะดะฐะปะธัั ะบะพะฝัะตะนะฝะตัั + volumes
docker-compose down -v

# ะฃะดะฐะปะธัั ะฝะตะธัะฟะพะปัะทัะตะผัะต ะพะฑัะฐะทั
docker image prune -a
```

## ๐ ะขัะตะฑะพะฒะฐะฝะธั

- Docker ะฒะตััะธะธ 20.10 ะธะปะธ ะฒััะต
- Docker Compose ะฒะตััะธะธ 2.0 ะธะปะธ ะฒััะต
- 2GB ัะฒะพะฑะพะดะฝะพะณะพ ะผะตััะฐ ะฝะฐ ะดะธัะบะต (ะดะปั ะพะฑัะฐะทะพะฒ)
- ะัะบััััะต ะฟะพััั: 3000 (Frontend), 8000 (API)

## ๐ ะะตะทะพะฟะฐัะฝะพััั

- โ๏ธ ะคะฐะนะป `.env` ัะพะดะตัะถะธั ัะตะบัะตัะฝัะต ัะพะบะตะฝั - **ะฝะต ะบะพะผะผะธัััะต ะตะณะพ ะฒ git**
- โ ะัะฟะพะปัะทัะนัะต `.env.example` ะดะปั ัะฐะฑะปะพะฝะฐ
- โ ะ production ะธัะฟะพะปัะทัะนัะต secrets management (Docker Secrets, Kubernetes Secrets)

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั

- [DevOps Roadmap](doc/devops-roadmap.md) - ะฟะปะฐะฝ ัะฐะทะฒะธัะธั DevOps
- [Env Template](doc/env-template.md) - ัะฐะฑะปะพะฝ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
- [Main README](../README.md) - ะพัะฝะพะฒะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั ะฟัะพะตะบัะฐ

## ๐ฏ ะกะฟัะธะฝัั

- โ **D0: Basic Docker Setup** (ัะตะบััะธะน) - ะฑะฐะทะพะฒะฐั ะฝะฐัััะพะนะบะฐ Docker
- ๐ **D1: Build & Publish** - ะฐะฒัะพะผะฐัะธัะตัะบะฐั ัะฑะพัะบะฐ ะธ ะฟัะฑะปะธะบะฐัะธั ะพะฑัะฐะทะพะฒ
- ๐ **D2: Server Deploy** - ัะฐะทะฒะตัััะฒะฐะฝะธะต ะฝะฐ ัะตัะฒะตัะต
- ๐ **D3: Auto Deploy** - ะฐะฒัะพะผะฐัะธัะตัะบะธะน ะดะตะฟะปะพะน ัะตัะตะท GitHub Actions

ะกะผ. ะฟะพะปะฝัะน ะฟะปะฐะฝ ะฒ [doc/devops-roadmap.md](doc/devops-roadmap.md)



